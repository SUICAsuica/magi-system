<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- ビューポート設定：スマホでの拡大縮小を禁止し、アプリっぽく見せる -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>MAGI SYSTEM - FINAL VER.</title>
    <style>
        /* --- フォント読み込み --- */
        /* 激太明朝体 (Shippori Mincho) と 縦長ゴシック (Antonio) */
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@900&family=Antonio:wght@700&display=swap');

        :root {
            /* --- MAGI カラーパレット (セル画風) --- */
            --c-orange: #ff6600;   /* 通常時のアンバー */
            --c-blue: #00ccff;     /* 承認のシアンブルー */
            --c-red: #ee0000;      /* 否定のソリッドレッド */
            --c-black: #000000;    /* 背景 */
            --c-grid: #002200;     /* 背景グリッド（濃い緑） */
            
            --border-w: 6px;       /* 枠線の太さ */
        }

        body {
            background-color: var(--c-black);
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Shippori Mincho', serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- メインステージ (1024x768 の固定比率で作る) --- */
        #stage {
            position: relative;
            width: 1024px;
            height: 768px;
            background: var(--c-black);
            transform-origin: center center; /* 中心基準で回転・拡大 */
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        /* --- 背景演出 --- */
        .grid-bg {
            position: absolute;
            top: 60px; width: 100%; height: 120px;
            /* スキャンライン風グリッド */
            background: repeating-linear-gradient(
                0deg, transparent, transparent 4px, var(--c-grid) 4px, var(--c-grid) 6px
            );
            z-index: 0;
        }

        /* --- ヘッダー文字 (提訴 / 決議) --- */
        .header-txt {
            position: absolute;
            top: 50px;
            font-size: 100px;
            font-weight: 900;
            color: var(--c-orange);
            line-height: 1;
            z-index: 10;
            transform: scale(1, 1.4); /* 縦に引き伸ばす */
            letter-spacing: -5px;
            filter: drop-shadow(4px 4px 0px #000); /* 影をつけて視認性アップ */
        }
        .h-left { left: 60px; }
        .h-right { right: 60px; opacity: 0.2; } /* 最初は暗い */

        /* --- 左上のコード情報 --- */
        .info-box {
            position: absolute;
            top: 180px; left: 50px;
            font-family: 'Antonio', sans-serif;
            color: var(--c-orange);
            z-index: 10;
        }
        .ib-title { font-size: 50px; letter-spacing: 3px; margin-bottom: 10px; }
        .ib-sub { font-size: 20px; letter-spacing: 1px; opacity: 0.8; }

        /* --- MAGI ユニットレイアウト --- */
        .magi-layout {
            position: absolute;
            top: 56%; left: 50%;
            transform: translate(-50%, -50%);
            width: 900px; height: 550px;
        }

        /* --- ユニット共通デザイン --- */
        .unit-frame {
            position: absolute;
            background-color: var(--c-orange); /* これが枠線の色になる */
            transition: background-color 0.05s; /* 色変化のアニメーション速度 */
        }
        .unit-core {
            position: absolute;
            background-color: var(--c-black);
            /* 枠線の太さ分だけ内側に配置 */
            top: var(--border-w); left: var(--border-w); right: var(--border-w); bottom: var(--border-w);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        /* --- 形状定義 (Clip-path) --- */
        /* BALTHASAR (上) */
        .shape-bal {
            top: 0; left: 50%; transform: translateX(-50%);
            width: 380px; height: 270px;
            clip-path: polygon(0 0, 100% 0, 100% 72%, 82% 100%, 18% 100%, 0 72%);
        }
        .shape-bal .unit-core { clip-path: polygon(0 0, 100% 0, 100% 72%, 82% 100%, 18% 100%, 0 72%); }

        /* CASPER (左下) */
        .shape-cas {
            bottom: 0; left: 0;
            width: 400px; height: 250px;
            clip-path: polygon(0 0, 72% 0, 100% 32%, 100% 100%, 0 100%);
        }
        .shape-cas .unit-core { clip-path: polygon(0 0, 72% 0, 100% 32%, 100% 100%, 0 100%); }

        /* MELCHIOR (右下) */
        .shape-mel {
            bottom: 0; right: 0;
            width: 400px; height: 250px;
            clip-path: polygon(28% 0, 100% 0, 100% 100%, 0 100%, 0 32%);
        }
        .shape-mel .unit-core { clip-path: polygon(28% 0, 100% 0, 100% 100%, 0 100%, 0 32%); }

        /* --- ラベル類 --- */
        .label-en {
            position: absolute; top: 15%;
            font-family: 'Antonio', sans-serif; font-size: 42px;
            color: transparent; /* 最初は文字色なし */
            -webkit-text-stroke: 1px var(--c-orange); /* 縁取りのみ */
            z-index: 5;
        }
        .label-jp {
            font-size: 90px; font-weight: 900; color: #000;
            z-index: 10; transform: scale(1, 1.1);
            display: none; /* 判定が出るまで非表示 */
            white-space: nowrap; margin-top: 10px;
        }
        .label-num {
            position: absolute; bottom: 10px; right: 20px;
            font-family: 'Antonio', sans-serif; font-size: 36px; color: var(--c-orange);
        }

        /* --- 接続パイプ --- */
        .pipe { position: absolute; background: var(--c-orange); z-index: -1; }
        .p-v { top: 260px; left: 50%; width: 10px; height: 70px; transform: translateX(-5px); }
        .p-l { top: 350px; left: 300px; width: 160px; height: 10px; transform: rotate(30deg); }
        .p-r { top: 350px; right: 300px; width: 160px; height: 10px; transform: rotate(-30deg); }
        .center-txt {
            position: absolute; top: 325px; left: 50%; transform: translateX(-50%);
            color: var(--c-orange); font-size: 32px; font-weight: 900; letter-spacing: 3px;
            animation: idle-pulse 2s infinite;
        }
        @keyframes idle-pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }

        /* --- 最終結果表示 --- */
        .result-stamp {
            position: absolute; top: 250px; right: 60px;
            border: 6px double var(--c-blue); padding: 0px 30px;
            transform: rotate(-3deg); display: none; z-index: 100;
            background: rgba(0,0,0,0.7);
        }
        .rs-text { font-size: 80px; font-weight: 900; color: var(--c-blue); transform: scale(1, 1.2); }

        /* --- アニメーション定義 --- */
        /* 思考中の激しいストロボ */
        .strobe .unit-frame { animation: strobe 0.08s infinite; }
        .strobe .unit-core { animation: strobe-in 0.08s infinite; }
        
        @keyframes strobe { 
            0% {background:var(--c-orange);} 
            50% {background:#fff;} 
            100% {background:#000;} 
        }
        @keyframes strobe-in { 
            0% {background:#000;} 
            50% {background:var(--c-orange);} 
            100% {background:#000;} 
        }

        /* 承認時のスタイル（青ベタ塗り） */
        .status-yes .unit-frame, .status-yes .unit-core { background-color: var(--c-blue); }
        .status-yes .label-en { color: #000; -webkit-text-stroke: 0; top: 10%; font-size: 30px; }
        .status-yes .label-jp { display: block; }
        .status-yes .label-num { color: #000; }

        /* 否定時のスタイル（赤ベタ塗り） */
        .status-no .unit-frame, .status-no .unit-core { background-color: var(--c-red); }
        .status-no .label-en { color: #000; -webkit-text-stroke: 0; top: 10%; font-size: 30px; }
        .status-no .label-jp { display: block; }
        .status-no .label-num { color: #000; }


        /* --- 入力モーダル (スマホ・PC共通) --- */
        #touch-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 999; cursor: pointer;
        }
        #input-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-input {
            width: 80%; max-width: 400px;
            background: transparent; border: none;
            border-bottom: 2px solid var(--c-orange);
            color: var(--c-orange); font-size: 32px; font-family: 'Shippori Mincho', serif;
            text-align: center; padding: 10px; outline: none; margin-bottom: 30px;
        }
        .modal-btn {
            background: var(--c-orange); color: #000; border: none;
            padding: 15px 40px; font-size: 20px; font-weight: bold; cursor: pointer;
            font-family: 'Antonio', sans-serif; clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%, 0% 30%);
        }
        .modal-btn:active { background: #fff; }

    </style>
</head>
<body>

    <!-- MAGI UI STAGE -->
    <div id="stage">
        <div class="grid-bg"></div>
        <div class="header-txt h-left">提 訴</div>
        <div class="header-txt h-right" id="h-res">決 議</div>

        <div class="info-box">
            <div class="ib-title">CODE: 378</div>
            <div class="ib-sub">
                FILE: MAGI_SYS<br>EXTENSION: 2024<br>PRIORITY: AAA
            </div>
        </div>

        <div id="result-box" class="result-stamp">
            <div id="result-txt" class="rs-text">可決</div>
        </div>

        <div class="magi-layout">
            <div class="pipe p-v"></div><div class="pipe p-l"></div><div class="pipe p-r"></div>
            <div class="center-txt">MAGI</div>
            
            <!-- BALTHASAR (MOTHER) -->
            <div id="u-bal" class="unit-frame shape-bal">
                <div class="unit-core">
                    <div class="label-en">BALTHASAR-2</div>
                    <div class="label-jp" id="txt-bal">承認</div>
                    <div class="label-num">2</div>
                </div>
            </div>
            <!-- CASPER (WOMAN) -->
            <div id="u-cas" class="unit-frame shape-cas">
                <div class="unit-core">
                    <div class="label-en">CASPER-3</div>
                    <div class="label-jp" id="txt-cas">承認</div>
                    <div class="label-num">3</div>
                </div>
            </div>
            <!-- MELCHIOR (SCIENTIST) -->
            <div id="u-mel" class="unit-frame shape-mel">
                <div class="unit-core">
                    <div class="label-en">MELCHIOR-1</div>
                    <div class="label-jp" id="txt-mel">承認</div>
                    <div class="label-num">1</div>
                </div>
            </div>
        </div>
    </div>

    <!-- INPUT INTERFACE -->
    <div id="touch-layer"></div>
    <div id="input-modal">
        <div style="color:var(--c-orange); margin-bottom:10px;">INPUT QUERY</div>
        <input type="text" id="modal-input" class="modal-input" placeholder="提訴内容を入力" autocomplete="off">
        <button class="modal-btn" onclick="submitQuery()">SUBMIT</button>
    </div>

    <script>
        const stage = document.getElementById('stage');
        const modal = document.getElementById('input-modal');
        const modalInput = document.getElementById('modal-input');
        const touchLayer = document.getElementById('touch-layer');

        // --- 1. 画面フィット & 自動回転ロジック ---
        function fitScreen() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            const stageW = 1024;
            const stageH = 768;
            const isPortrait = h > w; // 縦長画面かどうか

            if (isPortrait) {
                // 縦画面なら90度回転させて、高さを幅として計算
                const scale = Math.min(h / stageW, w / stageH);
                stage.style.transform = `rotate(90deg) scale(${scale})`;
            } else {
                // 横画面ならそのままフィット
                const scale = Math.min(w / stageW, h / stageH);
                stage.style.transform = `rotate(0deg) scale(${scale})`;
            }
        }
        window.addEventListener('resize', fitScreen);
        fitScreen(); // 初期実行

        // --- 2. 入力制御 ---
        touchLayer.addEventListener('click', () => {
            modal.style.display = 'flex';
            setTimeout(() => modalInput.focus(), 100);
        });
        
        modal.addEventListener('click', (e) => {
            if(e.target === modal) modal.style.display = 'none';
        });

        modalInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') submitQuery();
        });

        function submitQuery() {
            const val = modalInput.value;
            if(val) {
                modal.style.display = 'none';
                modalInput.value = ''; // 入力クリア
                runSequence(); // 開始
            }
        }

        // --- 3. MAGI 確率 & 演出ロジック (最重要) ---
        const els = {
            bal: { f: document.getElementById('u-bal'), t: document.getElementById('txt-bal') },
            cas: { f: document.getElementById('u-cas'), t: document.getElementById('txt-cas') },
            mel: { f: document.getElementById('u-mel'), t: document.getElementById('txt-mel') },
            hRes: document.getElementById('h-res'),
            rBox: document.getElementById('result-box'),
            rTxt: document.getElementById('result-txt')
        };

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        // ★ 性格付けロジック ★
        // ここで否決確率を調整
        function decide(id) {
            const r = Math.random();
            
            // MELCHIOR (科学者): 合理的。80%でYES。
            if(id === 'mel') return r > 0.2;
            
            // BALTHASAR (母): 迷う。50%でYES/NO。
            if(id === 'bal') return r > 0.5;
            
            // CASPER (女): 意地悪。70%でNO（裏切り）。
            if(id === 'cas') return r > 0.7;
            
            return true;
        }

        async function runSequence() {
            // リセット
            els.rBox.style.display = 'none';
            els.hRes.style.opacity = 0.2;
            ['bal','cas','mel'].forEach(k => {
                els[k].f.className = els[k].f.className.replace(/status-\w+|strobe/g, '').trim();
            });

            // A. 思考フェーズ (ストロボ)
            // 全員同時に高速点滅
            ['bal','cas','mel'].forEach(k => els[k].f.classList.add('strobe'));
            
            // 2〜3.5秒待つ (ランダム)
            await sleep(2000 + Math.random() * 1500);
            
            // 点滅停止
            ['bal','cas','mel'].forEach(k => els[k].f.classList.remove('strobe'));
            await sleep(150); // 一瞬の静寂

            // B. 判定開示フェーズ (メルキオール -> バルタザール -> カスパー)
            let yesCount = 0;
            const order = ['mel', 'bal', 'cas'];

            for (let k of order) {
                const isYes = decide(k);
                
                // タメ（演出の間）
                await sleep(700); 
                
                if (isYes) {
                    els[k].f.classList.add('status-yes');
                    els[k].t.innerText = '承認';
                    yesCount++;
                } else {
                    els[k].f.classList.add('status-no');
                    els[k].t.innerText = '否定';
                }
            }

            // C. 最終決議フェーズ
            await sleep(800);
            const approved = yesCount >= 2; // 過半数

            els.hRes.style.opacity = 1;
            els.rBox.style.display = 'block';
            els.rTxt.innerText = approved ? '可決' : '否決';
            
            const color = approved ? 'var(--c-blue)' : 'var(--c-red)';
            els.rTxt.style.color = color;
            els.rBox.style.borderColor = color;

            // 否決時は画面全体を赤くフラッシュさせる警告演出
            if (!approved) {
                document.body.style.backgroundColor = 'var(--c-red)';
                setTimeout(() => {
                    document.body.style.transition = 'background-color 0.5s';
                    document.body.style.backgroundColor = 'var(--c-black)';
                }, 100);
            }
        }

    </script>
</body>
</html>